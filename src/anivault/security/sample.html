<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AniVault - ì• ë‹ˆë©”ì´ì…˜ ì»¬ë ‰ì…˜ ê´€ë¦¬</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      margin: 0;
      padding: 0;
      color: #333;
      overflow: hidden;
    }

    .app-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      width: 100%;
      background: #f8fafc;
      margin: 0;
      padding: 0;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 1.2rem 2rem;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1600px;
      margin: 0 auto;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      background: white;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }

    .header-actions { display: flex; gap: 12px; }

    .btn {
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-primary {
      background: white;
      color: #667eea;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255,255,255,0.3);
    }

    .btn-secondary {
      background: rgba(255,255,255,0.2);
      color: white;
      border: 1px solid rgba(255,255,255,0.3);
    }

    .btn-secondary:hover { background: rgba(255,255,255,0.3); }

    /* Main */
    .main-content {
      flex: 1;
      display: flex;
      overflow: hidden;
      max-width: 1600px;
      margin: 0 auto;
      width: 100%;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: white;
      border-right: 1px solid #e2e8f0;
      padding: 1.5rem;
      overflow-y: auto;
    }

    .sidebar-section { margin-bottom: 2rem; }

    .sidebar-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: #64748b;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.8rem;
    }

    .sidebar-item {
      padding: 0.8rem 1rem;
      border-radius: 8px;
      margin-bottom: 0.4rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 10px;
      user-select: none;
    }

    .sidebar-item:hover { background: #f1f5f9; }

    .sidebar-item.active {
      background: #667eea;
      color: white;
    }

    .stats-card {
      background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
      padding: 1rem;
      border-radius: 10px;
      margin-top: 1rem;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }

    .stat-item:last-child { border-bottom: none; }

    .stat-label { font-size: 0.85rem; color: #64748b; }

    .stat-value { font-weight: 600; color: #667eea; }

    /* Workspace */
    .workspace {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: #f8fafc;
    }

    .toolbar {
      background: white;
      padding: 1rem 2rem;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .toolbar .hint {
      font-size: 0.85rem;
      color: #64748b;
    }

    .search-box { flex: 1; max-width: 420px; position: relative; }

    .search-box input {
      width: 100%;
      padding: 0.7rem 1rem 0.7rem 2.5rem;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-size: 0.9rem;
      transition: all 0.2s;
      background: #fff;
    }

    .search-box input:focus { outline: none; border-color: #667eea; }

    .search-icon {
      position: absolute;
      left: 0.8rem;
      top: 50%;
      transform: translateY(-50%);
      color: #94a3b8;
    }

    /* View container */
    .view-container {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .view {
      flex: 1;
      overflow-y: auto;
      padding: 2rem;
      display: none;
    }

    .view.active { display: block; }

    /* Cards & panels */
    .panel {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 1.25rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 1rem;
    }

    .panel-title {
      font-size: 1rem;
      font-weight: 700;
      color: #0f172a;
    }

    .muted { color: #64748b; }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .grid-3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 1rem;
    }

    @media (max-width: 1100px) {
      .grid-2, .grid-3 { grid-template-columns: 1fr; }
      .sidebar { width: 250px; }
    }

    /* Groups view */
    .groups-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1.5rem;
    }

    .group-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: all 0.3s;
      cursor: pointer;
      border: 1px solid rgba(226, 232, 240, 0.8);
    }

    .group-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(102,126,234,0.2);
    }

    .group-card-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 1.2rem;
    }

    .group-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .group-meta {
      font-size: 0.85rem;
      opacity: 0.9;
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .group-card-body { padding: 1.2rem; }

    .group-info {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      margin-bottom: 1rem;
    }

    .info-badge {
      padding: 0.4rem 0.8rem;
      background: #f1f5f9;
      border-radius: 6px;
      font-size: 0.8rem;
      color: #475569;
      font-weight: 600;
    }

    .file-count { color: #667eea; font-weight: 800; }

    .group-progress { margin-top: 1rem; }

    .progress-label {
      font-size: 0.8rem;
      color: #64748b;
      margin-bottom: 0.4rem;
      display: flex;
      justify-content: space-between;
    }

    .progress-bar {
      height: 6px;
      background: #e2e8f0;
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      transition: width 0.3s;
    }

    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }

    th, td {
      text-align: left;
      padding: 0.8rem;
      border-bottom: 1px solid #e2e8f0;
      vertical-align: top;
    }

    th {
      color: #475569;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.4px;
      background: #f8fafc;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 0.25rem 0.55rem;
      border-radius: 999px;
      font-size: 0.78rem;
      font-weight: 700;
      background: #eef2ff;
      color: #4f46e5;
      border: 1px solid rgba(79,70,229,0.15);
    }

    .tag.warn { background: #fffbeb; color: #b45309; border-color: rgba(180,83,9,0.15); }
    .tag.ok { background: #ecfdf5; color: #047857; border-color: rgba(4,120,87,0.15); }

    /* Detail panel */
    .detail-panel {
      position: fixed;
      right: -500px;
      top: 0;
      width: 500px;
      height: 100vh;
      background: white;
      box-shadow: -4px 0 24px rgba(0,0,0,0.1);
      transition: right 0.3s;
      z-index: 1000;
      overflow-y: auto;
      border-left: 1px solid #e2e8f0;
    }

    .detail-panel.open { right: 0; }

    .detail-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 1.5rem;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .detail-close {
      position: absolute;
      right: 1rem;
      top: 1rem;
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .detail-close:hover { background: rgba(255,255,255,0.3); }

    .detail-content { padding: 1.5rem; }

    .detail-section { margin-bottom: 2rem; }

    .detail-section-title {
      font-size: 0.9rem;
      font-weight: 800;
      color: #64748b;
      margin-bottom: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .file-list { list-style: none; }

    .file-item {
      padding: 1rem;
      background: #f8fafc;
      border-radius: 8px;
      margin-bottom: 0.8rem;
      border-left: 3px solid #667eea;
    }

    .file-name {
      font-weight: 700;
      margin-bottom: 0.4rem;
      word-break: break-all;
    }

    .file-meta { font-size: 0.8rem; color: #64748b; }

    .action-buttons { display: flex; gap: 0.8rem; margin-top: 1.5rem; }

    .btn-action {
      flex: 1;
      padding: 0.8rem;
      border: none;
      border-radius: 8px;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-match { background: #667eea; color: white; }
    .btn-match:hover { background: #5568d3; }

    .btn-organize { background: #10b981; color: white; }
    .btn-organize:hover { background: #059669; }

    .btn-ghost {
      background: #f1f5f9;
      color: #0f172a;
      border: 1px solid #e2e8f0;
    }
    .btn-ghost:hover { background: #e2e8f0; }

    /* Status bar */
    .status-bar {
      background: white;
      border-top: 1px solid #e2e8f0;
      padding: 0.8rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.85rem;
      color: #64748b;
    }

    .status-left { display: flex; gap: 2rem; }

    .status-item { display: flex; align-items: center; gap: 6px; }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #10b981;
    }

    /* Loading */
    .loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .loading-overlay.active { display: flex; }

    .loading-content {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      text-align: center;
      width: min(520px, 92vw);
    }

    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid #e2e8f0;
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.55);
      z-index: 3000;
      align-items: center;
      justify-content: center;
      padding: 1.25rem;
    }

    .modal-overlay.active { display: flex; }

    .modal {
      background: white;
      border-radius: 14px;
      width: min(780px, 96vw);
      max-height: 86vh;
      overflow: auto;
      box-shadow: 0 18px 40px rgba(0,0,0,0.2);
      border: 1px solid rgba(226,232,240,0.9);
    }

    .modal-header {
      padding: 1rem 1.25rem;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      position: sticky;
      top: 0;
      background: white;
      z-index: 1;
    }

    .modal-body { padding: 1.25rem; }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .field label {
      display: block;
      font-size: 0.85rem;
      color: #475569;
      font-weight: 700;
      margin-bottom: 0.4rem;
    }

    .field input, .field select {
      width: 100%;
      padding: 0.75rem 0.9rem;
      border-radius: 10px;
      border: 2px solid #e2e8f0;
      outline: none;
      transition: border-color 0.2s;
      font-size: 0.95rem;
    }

    .field input:focus, .field select:focus { border-color: #667eea; }

    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      padding: 1rem 1.25rem;
      border-top: 1px solid #e2e8f0;
      background: #f8fafc;
    }

    @media (max-width: 720px) {
      .form-row { grid-template-columns: 1fr; }
      .sidebar { display: none; }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <div class="logo-icon">ğŸ“</div>
          <div>
            <div>AniVault</div>
            <div style="font-size: 0.7rem; opacity: 0.8;">v1.0.0</div>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary" id="btnSettings">âš™ï¸ ì„¤ì •</button>
          <button class="btn btn-primary" onclick="scanDirectory()">ğŸ“‚ ë””ë ‰í„°ë¦¬ ìŠ¤ìº”</button>
        </div>
      </div>
    </header>

    <!-- Main -->
    <div class="main-content">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-section">
          <div class="sidebar-title">ì‘ì—…</div>
          <div class="sidebar-item active" data-view="groups">ğŸ“Š ê·¸ë£¹ ê´€ë¦¬</div>
          <div class="sidebar-item" data-view="tmdb">ğŸ¬ TMDB ë§¤ì¹­</div>
          <div class="sidebar-item" data-view="organize">ğŸ“¦ íŒŒì¼ ì •ë¦¬</div>
          <div class="sidebar-item" data-view="rollback">â†©ï¸ ë¡¤ë°± ê´€ë¦¬</div>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-title">ë„êµ¬</div>
          <div class="sidebar-item" data-view="verify">âœ… ê²€ì¦</div>
          <div class="sidebar-item" data-view="cache">ğŸ’¾ ìºì‹œ ê´€ë¦¬</div>
          <div class="sidebar-item" data-view="logs">ğŸ“ ë¡œê·¸ ë³´ê¸°</div>
        </div>

        <div class="stats-card">
          <div class="sidebar-title">í†µê³„</div>
          <div class="stat-item">
            <span class="stat-label">ì´ ê·¸ë£¹</span>
            <span class="stat-value" id="totalGroups">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">ì´ íŒŒì¼</span>
            <span class="stat-value" id="totalFiles">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">ë§¤ì¹­ ì™„ë£Œ</span>
            <span class="stat-value" id="matchedGroups">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">ì •ë¦¬ ëŒ€ê¸°</span>
            <span class="stat-value" id="pendingOrganize">0</span>
          </div>
        </div>
      </aside>

      <!-- Workspace -->
      <main class="workspace">
        <!-- Context toolbar (changes per view) -->
        <div class="toolbar" id="toolbar">
          <!-- injected -->
        </div>

        <!-- Views -->
        <div class="view-container">
          <!-- Groups -->
          <section class="view active" id="view-groups">
            <div class="groups-grid" id="groupsGrid"></div>
          </section>

          <!-- TMDB -->
          <section class="view" id="view-tmdb">
            <div class="grid-2">
              <div class="panel">
                <div class="panel-header">
                  <div>
                    <div class="panel-title">ë¯¸ë§¤ì¹­ ê·¸ë£¹ í</div>
                    <div class="muted" style="font-size:0.85rem; margin-top:0.25rem;">ìë™ ì¶”ì²œ í›„ë³´ë¥¼ í™•ì¸í•˜ê³  í™•ì • ë§¤ì¹­ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</div>
                  </div>
                  <button class="btn btn-ghost" onclick="runTmdbBatchSuggest()">âœ¨ ìë™ ì¶”ì²œ</button>
                </div>
                <div style="overflow:auto; border-radius:12px; border:1px solid #e2e8f0;">
                  <table>
                    <thead>
                      <tr>
                        <th style="width:38%">ê·¸ë£¹</th>
                        <th style="width:22%">ìƒíƒœ</th>
                        <th style="width:22%">ì¶”ì²œ í›„ë³´</th>
                        <th style="width:18%">ì•¡ì…˜</th>
                      </tr>
                    </thead>
                    <tbody id="tmdbQueue"></tbody>
                  </table>
                </div>
              </div>

              <div class="panel">
                <div class="panel-header">
                  <div>
                    <div class="panel-title">ì„ íƒëœ ê·¸ë£¹</div>
                    <div class="muted" style="font-size:0.85rem; margin-top:0.25rem;">í›„ë³´ë¥¼ ì„ íƒí•˜ê³  â€˜í™•ì • ë§¤ì¹­â€™ì„ ëˆ„ë¥´ì„¸ìš”.</div>
                  </div>
                  <div style="display:flex; gap:10px;">
                    <button class="btn btn-ghost" onclick="clearTmdbSelection()">ì„ íƒ í•´ì œ</button>
                    <button class="btn btn-primary" onclick="confirmTmdbMatch()">âœ… í™•ì • ë§¤ì¹­</button>
                  </div>
                </div>

                <div id="tmdbSelected" class="muted" style="font-size:0.95rem;">
                  ì¢Œì¸¡ íì—ì„œ ê·¸ë£¹ì„ ì„ íƒí•˜ì„¸ìš”.
                </div>

                <div style="margin-top:1rem;">
                  <div class="panel-title" style="font-size:0.95rem; margin-bottom:0.6rem;">ì¶”ì²œ í›„ë³´</div>
                  <div id="tmdbCandidates" class="muted" style="font-size:0.9rem;">ì„ íƒëœ ê·¸ë£¹ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                </div>
              </div>
            </div>
          </section>

          <!-- Organize -->
          <section class="view" id="view-organize">
            <div class="grid-3">
              <div class="panel">
                <div class="panel-header">
                  <div>
                    <div class="panel-title">ì •ë¦¬ ê·œì¹™</div>
                    <div class="muted" style="font-size:0.85rem; margin-top:0.25rem;">ìƒ˜í”Œ ë£°ì…‹(í”„ë¦¬ì…‹) ì ìš©</div>
                  </div>
                </div>
                <div style="display:flex; flex-direction:column; gap:10px;">
                  <div class="info-badge" style="display:block;">í´ë”: /Anime/{Title}/Season {S}</div>
                  <div class="info-badge" style="display:block;">íŒŒì¼ëª…: {Title}.S{S}E{E}.{Res}.{Lang}</div>
                  <div class="info-badge" style="display:block;">ë¶€ê°€: ìë§‰/ë©”íƒ€ë°ì´í„° ë¶„ë¦¬ ì €ì¥</div>
                  <button class="btn btn-primary" onclick="applyRulePreset()" style="justify-content:center;">í”„ë¦¬ì…‹ ì ìš©</button>
                </div>
              </div>

              <div class="panel">
                <div class="panel-header">
                  <div>
                    <div class="panel-title">ì •ë¦¬ ëŒ€ê¸° í</div>
                    <div class="muted" style="font-size:0.85rem; margin-top:0.25rem;">ë§¤ì¹­ ì™„ë£Œ ê·¸ë£¹ë§Œ ì •ë¦¬ ê°€ëŠ¥</div>
                  </div>
                  <div style="display:flex; gap:8px;">
                    <button class="btn btn-ghost" onclick="refreshOrganizeQueue()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                    <button class="btn btn-primary" onclick="executeAllOrganize()">â–¶ï¸ ì „ì²´ ì‹¤í–‰</button>
                  </div>
                </div>
                <div style="overflow:auto; border-radius:12px; border:1px solid #e2e8f0; max-height:420px;">
                  <table>
                    <thead>
                      <tr>
                        <th>ê·¸ë£¹</th>
                        <th>íŒŒì¼</th>
                        <th>ëŒ€ìƒ ê²½ë¡œ</th>
                        <th>ì•¡ì…˜</th>
                      </tr>
                    </thead>
                    <tbody id="organizeQueue"></tbody>
                  </table>
                </div>
              </div>

              <div class="panel">
                <div class="panel-header">
                  <div>
                    <div class="panel-title">í”„ë¦¬í”Œë¼ì´íŠ¸ ì²´í¬</div>
                    <div class="muted" style="font-size:0.85rem; margin-top:0.25rem;">ì¶©ëŒ/ê¶Œí•œ/ì¤‘ë³µ ê²€ì‚¬</div>
                  </div>
                  <button class="btn btn-primary" onclick="runPreflight()">ğŸ§ª ì²´í¬ ì‹¤í–‰</button>
                </div>
                <div id="preflightResults" style="display:flex; flex-direction:column; gap:10px;">
                  <div class="tag">ëŒ€ê¸°</div>
                  <div class="muted" style="font-size:0.9rem;">ì •ë¦¬ ì‘ì—… ì „ì— ì²´í¬ë¥¼ ì‹¤í–‰í•´ ì•ˆì „ì„±ì„ í™•ë³´í•©ë‹ˆë‹¤.</div>
                </div>
              </div>
            </div>

            <div class="panel" style="margin-top:1rem;">
              <div class="panel-header">
                <div>
                  <div class="panel-title">ì‹¤í–‰ ë¡œê·¸ (ì •ë¦¬)</div>
                  <div class="muted" style="font-size:0.85rem; margin-top:0.25rem;">ìµœê·¼ ì‘ì—…/ì—ëŸ¬/ë¡¤ë°± í¬ì¸íŠ¸ ê¸°ë¡</div>
                </div>
                <button class="btn btn-ghost" onclick="appendOrganizeLog()">â• ìƒ˜í”Œ ë¡œê·¸ ì¶”ê°€</button>
              </div>
              <div id="organizeLog" class="muted" style="font-size:0.9rem; line-height:1.7; white-space:pre-wrap;"></div>
            </div>
          </section>

          <!-- Rollback -->
          <section class="view" id="view-rollback">
            <div class="grid-2">
              <div class="panel">
                <div class="panel-header">
                  <div>
                    <div class="panel-title">ë¡¤ë°± í¬ì¸íŠ¸</div>
                    <div class="muted" style="font-size:0.85rem; margin-top:0.25rem;">ì •ë¦¬ ì‹¤í–‰ë§ˆë‹¤ ìë™ ìƒì„±</div>
                  </div>
                  <button class="btn btn-ghost" onclick="seedRollback()">ğŸ§· ìƒ˜í”Œ ìƒì„±</button>
                </div>
                <div style="overflow:auto; border-radius:12px; border:1px solid #e2e8f0; max-height:520px;">
                  <table>
                    <thead>
                      <tr>
                        <th>ì‹œê°„</th>
                        <th>ê·¸ë£¹</th>
                        <th>ë³€ê²½</th>
                        <th>ìƒíƒœ</th>
                        <th>ì•¡ì…˜</th>
                      </tr>
                    </thead>
                    <tbody id="rollbackTable"></tbody>
                  </table>
                </div>
              </div>

              <div class="panel">
                <div class="panel-header">
                  <div>
                    <div class="panel-title">ì„ íƒ ìƒì„¸</div>
                    <div class="muted" style="font-size:0.85rem; margin-top:0.25rem;">ë¡¤ë°± ëŒ€ìƒ íŒŒì¼/ê²½ë¡œë¥¼ í™•ì¸</div>
                  </div>
                  <button class="btn btn-primary" onclick="executeRollback()">â†©ï¸ ë¡¤ë°± ì‹¤í–‰</button>
                </div>
                <div id="rollbackDetail" class="muted" style="font-size:0.95rem;">í…Œì´ë¸”ì—ì„œ í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.</div>
              </div>
            </div>
          </section>

          <!-- Cache -->
          <section class="view" id="view-cache">
            <div class="grid-3">
              <div class="panel">
                <div class="panel-header">
                  <div>
                    <div class="panel-title">ìºì‹œ ìƒíƒœ</div>
                    <div class="muted" style="font-size:0.85rem; margin-top:0.25rem;">ë©”íƒ€ë°ì´í„°/ì´ë¯¸ì§€/ê²€ìƒ‰ ì¸ë±ìŠ¤</div>
                  </div>
                </div>
                <div style="display:flex; flex-direction:column; gap:10px;">
                  <div class="info-badge" style="display:block;">TMDB ìºì‹œ: <strong id="cacheTmdb">ì •ìƒ</strong></div>
                  <div class="info-badge" style="display:block;">ì´ë¯¸ì§€ ìºì‹œ: <strong id="cacheImages">ì •ìƒ</strong></div>
                  <div class="info-badge" style="display:block;">ì¸ë±ìŠ¤ ìºì‹œ: <strong id="cacheIndex">ì •ìƒ</strong></div>
                </div>
              </div>

              <div class="panel">
                <div class="panel-header">
                  <div>
                    <div class="panel-title">ìœ ì§€ë³´ìˆ˜</div>
                    <div class="muted" style="font-size:0.85rem; margin-top:0.25rem;">ì •ë¦¬/ê²€ì¦/ì¬ë¹Œë“œ</div>
                  </div>
                </div>
                <div style="display:flex; flex-direction:column; gap:10px;">
                  <button class="btn btn-ghost" onclick="pruneCache()" style="justify-content:center;">ğŸ§¹ ì˜¤ë˜ëœ ìºì‹œ ì •ë¦¬</button>
                  <button class="btn btn-ghost" onclick="verifyCache()" style="justify-content:center;">âœ… ìºì‹œ ë¬´ê²°ì„± ê²€ì‚¬</button>
                  <button class="btn btn-primary" onclick="rebuildIndex()" style="justify-content:center;">ğŸ§± ì¸ë±ìŠ¤ ì¬ë¹Œë“œ</button>
                </div>
              </div>

              <div class="panel">
                <div class="panel-header">
                  <div>
                    <div class="panel-title">ìš©ëŸ‰</div>
                    <div class="muted" style="font-size:0.85rem; margin-top:0.25rem;">ìƒ˜í”Œ ìˆ˜ì¹˜</div>
                  </div>
                </div>
                <div style="display:flex; flex-direction:column; gap:10px;">
                  <div class="info-badge" style="display:block;">ì´ ìºì‹œ: <strong id="cacheTotal">1.2 GB</strong></div>
                  <div class="info-badge" style="display:block;">TMDB: <strong id="cacheTotalTmdb">220 MB</strong></div>
                  <div class="info-badge" style="display:block;">ì´ë¯¸ì§€: <strong id="cacheTotalImages">720 MB</strong></div>
                  <div class="info-badge" style="display:block;">ì¸ë±ìŠ¤: <strong id="cacheTotalIndex">260 MB</strong></div>
                </div>
              </div>
            </div>

            <div class="panel" style="margin-top:1rem;">
              <div class="panel-header">
                <div>
                  <div class="panel-title">ìºì‹œ ì´ë²¤íŠ¸</div>
                  <div class="muted" style="font-size:0.85rem; margin-top:0.25rem;">ìµœê·¼ ì •ë¦¬/ì¬ë¹Œë“œ ê¸°ë¡</div>
                </div>
                <button class="btn btn-ghost" onclick="appendCacheEvent()">â• ì´ë²¤íŠ¸ ì¶”ê°€</button>
              </div>
              <div id="cacheEvents" class="muted" style="font-size:0.9rem; line-height:1.7; white-space:pre-wrap;"></div>
            </div>
          </section>

          <!-- Verify -->
          <section class="view" id="view-verify">
            <div class="grid-2">
              <div class="panel">
                <div class="panel-header">
                  <div>
                    <div class="panel-title">TMDB ì—°ê²° ê²€ì¦</div>
                    <div class="muted" style="font-size:0.85rem; margin-top:0.25rem;">API í‚¤ ë° ì—°ê²° ìƒíƒœ í™•ì¸</div>
                  </div>
                  <button class="btn btn-primary" onclick="runVerify()">ğŸ” ê²€ì¦ ì‹¤í–‰</button>
                </div>
                <div id="verifyResults" style="display:flex; flex-direction:column; gap:1rem;">
                  <div class="tag">ëŒ€ê¸°</div>
                  <div class="muted" style="font-size:0.9rem;">ê²€ì¦ì„ ì‹¤í–‰í•˜ì—¬ TMDB ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.</div>
                </div>
                <div style="margin-top:1.5rem;">
                  <div class="panel-title" style="font-size:0.95rem; margin-bottom:0.8rem;">ê²€ì¦ í•­ëª©</div>
                  <div style="display:flex; flex-direction:column; gap:0.8rem;">
                    <div style="display:flex; align-items:center; gap:0.8rem;">
                      <div class="tag" id="verifyApiKey">âš ï¸ API í‚¤</div>
                      <span class="muted" style="font-size:0.85rem;">API í‚¤ ìœ íš¨ì„± ê²€ì‚¬</span>
                    </div>
                    <div style="display:flex; align-items:center; gap:0.8rem;">
                      <div class="tag" id="verifyConnectivity">âš ï¸ ì—°ê²°</div>
                      <span class="muted" style="font-size:0.85rem;">TMDB ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸</span>
                    </div>
                    <div style="display:flex; align-items:center; gap:0.8rem;">
                      <div class="tag" id="verifyAuth">âš ï¸ ì¸ì¦</div>
                      <span class="muted" style="font-size:0.85rem;">API í‚¤ ì¸ì¦ ê²€ì¦</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="panel">
                <div class="panel-header">
                  <div>
                    <div class="panel-title">ì„¤ì • ê²€ì¦</div>
                    <div class="muted" style="font-size:0.85rem; margin-top:0.25rem;">ì„¤ì • íŒŒì¼ ë° ì˜µì…˜ í™•ì¸</div>
                  </div>
                  <button class="btn btn-ghost" onclick="verifySettings()">âš™ï¸ ì„¤ì • ê²€ì¦</button>
                </div>
                <div id="settingsVerifyResults" style="display:flex; flex-direction:column; gap:1rem;">
                  <div class="tag">ëŒ€ê¸°</div>
                  <div class="muted" style="font-size:0.9rem;">ì„¤ì • ê²€ì¦ì„ ì‹¤í–‰í•˜ì—¬ êµ¬ì„± íŒŒì¼ì˜ ìœ íš¨ì„±ì„ í™•ì¸í•˜ì„¸ìš”.</div>
                </div>
                <div style="margin-top:1.5rem;">
                  <div class="panel-title" style="font-size:0.95rem; margin-bottom:0.8rem;">ì„¤ì • ìƒíƒœ</div>
                  <div style="display:flex; flex-direction:column; gap:0.8rem;">
                    <div class="info-badge" style="display:block;">
                      <strong>ì„¤ì • íŒŒì¼:</strong> <span id="configFileStatus">í™•ì¸ í•„ìš”</span>
                    </div>
                    <div class="info-badge" style="display:block;">
                      <strong>API í‚¤ ì„¤ì •:</strong> <span id="apiKeyConfigStatus">í™•ì¸ í•„ìš”</span>
                    </div>
                    <div class="info-badge" style="display:block;">
                      <strong>í´ë” ê²½ë¡œ:</strong> <span id="folderPathStatus">í™•ì¸ í•„ìš”</span>
                    </div>
                    <div class="info-badge" style="display:block;">
                      <strong>ìë™ ìŠ¤ìº”:</strong> <span id="autoScanStatus">í™•ì¸ í•„ìš”</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Logs -->
          <section class="view" id="view-logs">
            <div class="grid-2">
              <div class="panel">
                <div class="panel-header">
                  <div>
                    <div class="panel-title">ë¡œê·¸ í•„í„°</div>
                    <div class="muted" style="font-size:0.85rem; margin-top:0.25rem;">ë ˆë²¨/ëª¨ë“ˆë³„ ì¡°íšŒ</div>
                  </div>
                  <button class="btn btn-ghost" onclick="seedLogs()">ğŸ§¾ ìƒ˜í”Œ ì±„ìš°ê¸°</button>
                </div>
                <div class="form-row">
                  <div class="field">
                    <label>ë ˆë²¨</label>
                    <select id="logLevel" onchange="renderLogs()">
                      <option value="ALL">ALL</option>
                      <option value="INFO">INFO</option>
                      <option value="WARN">WARN</option>
                      <option value="ERROR">ERROR</option>
                    </select>
                  </div>
                  <div class="field">
                    <label>ëª¨ë“ˆ</label>
                    <select id="logModule" onchange="renderLogs()">
                      <option value="ALL">ALL</option>
                      <option value="scanner">scanner</option>
                      <option value="tmdb">tmdb</option>
                      <option value="organizer">organizer</option>
                      <option value="cache">cache</option>
                    </select>
                  </div>
                </div>
                <div class="field">
                  <label>ê²€ìƒ‰</label>
                  <input id="logQuery" placeholder="ë©”ì‹œì§€ ê²€ìƒ‰..." oninput="renderLogs()" />
                </div>
                <div style="margin-top:1rem; display:flex; gap:10px;">
                  <button class="btn btn-ghost" onclick="clearLogs()">ì§€ìš°ê¸°</button>
                  <button class="btn btn-primary" onclick="exportLogs()">ë‚´ë³´ë‚´ê¸°(ìƒ˜í”Œ)</button>
                </div>
              </div>

              <div class="panel">
                <div class="panel-header">
                  <div>
                    <div class="panel-title">ì‹¤ì‹œê°„ ë¡œê·¸</div>
                    <div class="muted" style="font-size:0.85rem; margin-top:0.25rem;">ìŠ¤í¬ë¡¤ í•˜ë‹¨ìœ¼ë¡œ ìë™ ìœ ì§€(ìƒ˜í”Œ)</div>
                  </div>
                  <button class="btn btn-ghost" onclick="appendLog()">â• ë¡œê·¸ ì¶”ê°€</button>
                </div>
                <div id="logViewer" style="height:520px; overflow:auto; background:#0b1020; color:#e5e7eb; border-radius:12px; padding:0.9rem; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size:0.85rem; line-height:1.6;"></div>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>

    <!-- Status bar -->
    <div class="status-bar">
      <div class="status-left">
        <div class="status-item">
          <span class="status-dot" id="statusDot"></span>
          <span id="statusText">ì‹œìŠ¤í…œ ì¤€ë¹„</span>
        </div>
        <div class="status-item">
          <span>ğŸ—ºï¸</span>
          <span id="currentPath">ë””ë ‰í„°ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</span>
        </div>
      </div>
      <div class="status-item">
        <span>ìºì‹œ: <strong id="cacheStatus">í™œì„±</strong></span>
      </div>
    </div>
  </div>

  <!-- Detail panel -->
  <div class="detail-panel" id="detailPanel">
    <div class="detail-header">
      <button class="detail-close" onclick="closeDetailPanel()">Ã—</button>
      <h2 id="detailTitle">ê·¸ë£¹ ìƒì„¸</h2>
      <div id="detailMeta" style="margin-top: 0.5rem; opacity: 0.9; font-size: 0.9rem;"></div>
    </div>
    <div class="detail-content">
      <div class="detail-section">
        <div class="detail-section-title">ê·¸ë£¹ ì •ë³´</div>
        <div id="detailInfo"></div>
      </div>
      <div class="detail-section">
        <div class="detail-section-title">íŒŒì¼ ëª©ë¡</div>
        <ul class="file-list" id="detailFiles"></ul>
      </div>
      <div class="action-buttons">
        <button class="btn-action btn-match" onclick="matchGroup()">TMDB ë§¤ì¹­</button>
        <button class="btn-action btn-organize" onclick="organizeGroup()">íŒŒì¼ ì •ë¦¬</button>
      </div>
    </div>
  </div>

  <!-- Loading overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
      <div class="spinner"></div>
      <div id="loadingMessage">ì²˜ë¦¬ ì¤‘...</div>
    </div>
  </div>

  <!-- Settings modal -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal" style="width: min(900px, 96vw);">
      <div class="modal-header">
        <div>
          <div class="panel-title" style="font-size:1.05rem;">ì„¤ì •</div>
          <div class="muted" style="font-size:0.85rem; margin-top:0.15rem;">TMDB API í‚¤ ë° í´ë” ì„¤ì •</div>
        </div>
        <button class="btn btn-ghost" onclick="closeSettings()">ë‹«ê¸°</button>
      </div>
      <div class="modal-body" style="padding:0;">
        <!-- Tab Navigation -->
        <div style="display:flex; border-bottom:1px solid #e2e8f0; background:#f8fafc;">
          <button class="tab-btn active" id="tabApiKey" onclick="switchSettingsTab('api')" style="padding:1rem 1.5rem; border:none; background:none; cursor:pointer; border-bottom:2px solid #667eea; font-weight:600; color:#667eea;">
            API Key
          </button>
          <button class="tab-btn" id="tabFolders" onclick="switchSettingsTab('folders')" style="padding:1rem 1.5rem; border:none; background:none; cursor:pointer; border-bottom:2px solid transparent; font-weight:500; color:#64748b;">
            Folders
          </button>
        </div>

        <!-- Tab Content -->
        <div style="padding:1.5rem;">
          <!-- API Key Tab -->
          <div id="settingsTabApi" class="settings-tab-content active">
            <div class="field">
              <label>TMDB API Key</label>
              <input id="settingApiKey" type="password" placeholder="Enter your TMDB API key" />
              <div class="muted" style="font-size:0.85rem; margin-top:0.5rem;">
                Get your API key from: <a href="https://www.themoviedb.org/settings/api" target="_blank" style="color:#667eea;">https://www.themoviedb.org/settings/api</a>
              </div>
            </div>
            <div style="margin-top:1.5rem; padding:1rem; background:#f8fafc; border-radius:8px; border:1px solid #e2e8f0;">
              <div class="panel-title" style="font-size:0.9rem; margin-bottom:0.5rem;">ğŸ’¡ ì°¸ê³ </div>
              <div class="muted" style="font-size:0.85rem; line-height:1.6;">
                API í‚¤ëŠ” .env íŒŒì¼ì— ì•ˆì „í•˜ê²Œ ì €ì¥ë©ë‹ˆë‹¤. (config.tomlì—ëŠ” ì €ì¥ë˜ì§€ ì•ŠìŒ)
              </div>
            </div>
          </div>

          <!-- Folders Tab -->
          <div id="settingsTabFolders" class="settings-tab-content" style="display:none;">
            <!-- Source Folder -->
            <div class="field" style="margin-bottom:1.5rem;">
              <label>Source Folder</label>
              <div style="display:flex; gap:0.5rem;">
                <input id="settingSourceFolder" type="text" placeholder="Select source folder for media files" style="flex:1;" />
                <button class="btn btn-ghost" onclick="browseFolder('source')">Browse...</button>
              </div>
              <div class="muted" style="font-size:0.85rem; margin-top:0.5rem;">ë¯¸ë””ì–´ íŒŒì¼ì´ ìˆëŠ” ì†ŒìŠ¤ í´ë”</div>
            </div>

            <!-- Target Folder -->
            <div class="field" style="margin-bottom:1.5rem;">
              <label>Target Folder</label>
              <div style="display:flex; gap:0.5rem;">
                <input id="settingTargetFolder" type="text" placeholder="Select target folder for organized files" style="flex:1;" />
                <button class="btn btn-ghost" onclick="browseFolder('target')">Browse...</button>
              </div>
              <div class="muted" style="font-size:0.85rem; margin-top:0.5rem;">ì •ë¦¬ëœ íŒŒì¼ì„ ì €ì¥í•  ëŒ€ìƒ í´ë”</div>
            </div>

            <!-- Organization Options -->
            <div style="margin-bottom:1.5rem; padding:1rem; background:#f8fafc; border-radius:8px; border:1px solid #e2e8f0;">
              <div class="panel-title" style="font-size:0.9rem; margin-bottom:0.8rem;">ì •ë¦¬ ì˜µì…˜</div>
              <div style="display:flex; flex-direction:column; gap:0.8rem;">
                <label style="display:flex; align-items:center; gap:0.8rem; cursor:pointer;">
                  <input id="settingOrganizeByResolution" type="checkbox" style="width:18px; height:18px;" />
                  <span>í•´ìƒë„ë³„ë¡œ ì •ë¦¬ (1080p, 720p ë“±)</span>
                </label>
                <label style="display:flex; align-items:center; gap:0.8rem; cursor:pointer;">
                  <input id="settingOrganizeByYear" type="checkbox" style="width:18px; height:18px;" />
                  <span>ì¶œì‹œ ì—°ë„ë³„ë¡œ ì •ë¦¬ (2013, 2020 ë“±)</span>
                </label>
              </div>
            </div>

            <!-- Auto Scan Settings -->
            <div style="padding:1rem; background:#f8fafc; border-radius:8px; border:1px solid #e2e8f0;">
              <div class="panel-title" style="font-size:0.9rem; margin-bottom:0.8rem;">ìë™ ìŠ¤ìº” ì„¤ì •</div>
              <div style="display:flex; flex-direction:column; gap:1rem;">
                <label style="display:flex; align-items:center; gap:0.8rem; cursor:pointer;">
                  <input id="settingAutoScanStartup" type="checkbox" style="width:18px; height:18px;" />
                  <span>ì‹œì‘ ì‹œ ì†ŒìŠ¤ í´ë” ìë™ ìŠ¤ìº”</span>
                </label>
                <div class="form-row">
                  <div class="field">
                    <label>ìŠ¤ìº” ê°„ê²© (ë¶„)</label>
                    <input id="settingAutoScanInterval" type="number" min="0" max="1440" value="0" />
                    <div class="muted" style="font-size:0.8rem; margin-top:0.25rem;">0 = ë¹„í™œì„±í™”</div>
                  </div>
                  <div class="field">
                    <label>í•˜ìœ„ ë””ë ‰í„°ë¦¬ í¬í•¨</label>
                    <label style="display:flex; align-items:center; gap:0.5rem; cursor:pointer; margin-top:0.5rem;">
                      <input id="settingIncludeSubdirs" type="checkbox" checked style="width:18px; height:18px;" />
                      <span style="font-size:0.85rem;">í•˜ìœ„ ë””ë ‰í„°ë¦¬ í¬í•¨</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="resetSettings()">ì´ˆê¸°í™”</button>
        <button class="btn btn-primary" onclick="saveSettings()">ì €ì¥</button>
      </div>
    </div>
  </div>

  <style>
    .tab-btn:hover {
      background: rgba(102,126,234,0.05);
    }
    .tab-btn.active {
      color: #667eea;
    }
    .settings-tab-content {
      display: none;
    }
    .settings-tab-content.active {
      display: block;
    }
  </style>

  <script>
    // ===== Sample data =====
    const sampleGroups = [
      { id: 1, title: "ì§„ê²©ì˜ ê±°ì¸ Season 4", season: 4, episodes: 16, files: 16, matched: true,  confidence: 95, resolution: "1080p", language: "ko" },
      { id: 2, title: "ê·€ë©¸ì˜ ì¹¼ë‚  ë¬´í•œì—´ì°¨í¸",  season: 1, episodes: 7,  files: 7,  matched: true,  confidence: 98, resolution: "1080p", language: "ko" },
      { id: 3, title: "ì£¼ìˆ íšŒì „ Season 2",         season: 2, episodes: 23, files: 23, matched: false, confidence: 0,  resolution: "1080p", language: "ko" },
      { id: 4, title: "ë‚˜ì˜ íˆì–´ë¡œ ì•„ì¹´ë°ë¯¸ì•„ Season 6", season: 6, episodes: 25, files: 25, matched: true, confidence: 92, resolution: "720p",  language: "ko" }
    ];

    let currentGroups = [...sampleGroups];
    let selectedGroup = null;
    let currentView = 'groups';

    // TMDB view state
    let tmdbSelectedId = null;
    const tmdbSuggestions = new Map(); // groupId -> candidates

    // Rollback state
    let rollbackItems = [];
    let rollbackSelectedId = null;

    // Logs state
    let logs = [];

    // ===== Init =====
    function init() {
      wireSidebar();
      renderToolbarForView('groups');
      renderGroups(currentGroups);
      updateStats();

      renderTmdbQueue();
      refreshOrganizeQueue();
      seedRollback();
      seedLogs();
      renderLogs();
      
      // Initialize verify view
      document.getElementById('verifyResults').innerHTML = `
        <div class="tag">ëŒ€ê¸°</div>
        <div class="muted" style="font-size:0.9rem;">ê²€ì¦ì„ ì‹¤í–‰í•˜ì—¬ TMDB ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.</div>
      `;
      document.getElementById('settingsVerifyResults').innerHTML = `
        <div class="tag">ëŒ€ê¸°</div>
        <div class="muted" style="font-size:0.9rem;">ì„¤ì • ê²€ì¦ì„ ì‹¤í–‰í•˜ì—¬ êµ¬ì„± íŒŒì¼ì˜ ìœ íš¨ì„±ì„ í™•ì¸í•˜ì„¸ìš”.</div>
      `;

      document.getElementById('btnSettings').addEventListener('click', openSettings);

      // seed
      document.getElementById('organizeLog').textContent = "[ready] ì •ë¦¬ ëª¨ë“ˆ ì¤€ë¹„ ì™„ë£Œ\n";
      document.getElementById('cacheEvents').textContent = "[ready] ìºì‹œ ëª¨ë“ˆ ì¤€ë¹„ ì™„ë£Œ\n";
    }

    function wireSidebar() {
      const items = document.querySelectorAll('.sidebar-item[data-view]');
      items.forEach(item => {
        item.addEventListener('click', () => switchView(item.dataset.view));
      });
    }

    // ===== View switching =====
    function switchView(view) {
      currentView = view;

      // sidebar active
      const items = document.querySelectorAll('.sidebar-item[data-view]');
      items.forEach(i => i.classList.toggle('active', i.dataset.view === view));

      // show view
      const views = document.querySelectorAll('.view');
      views.forEach(v => v.classList.remove('active'));
      const active = document.getElementById(`view-${view}`);
      if (active) active.classList.add('active');

      // toolbar
      renderToolbarForView(view);

      // status
      setStatus(`íƒ­ ì „í™˜: ${view}`, 'ok');
    }

    function renderToolbarForView(view) {
      const toolbar = document.getElementById('toolbar');

      // default
      const commonRight = `
        <span class="hint">í˜„ì¬ íƒ­: <strong>${labelForView(view)}</strong></span>
      `;

      if (view === 'groups') {
        toolbar.innerHTML = `
          <div class="search-box">
            <span class="search-icon">ğŸ”</span>
            <input id="groupSearch" type="text" placeholder="ê·¸ë£¹ ë˜ëŠ” íŒŒì¼ ê²€ìƒ‰..." oninput="searchGroups(this.value)" />
          </div>
          <button class="btn btn-secondary" onclick="filterGroups('all')">ì „ì²´</button>
          <button class="btn btn-secondary" onclick="filterGroups('matched')">ë§¤ì¹­ë¨</button>
          <button class="btn btn-secondary" onclick="filterGroups('unmatched')">ë¯¸ë§¤ì¹­</button>
          ${commonRight}
        `;
        return;
      }

      if (view === 'tmdb') {
        toolbar.innerHTML = `
          <div class="search-box">
            <span class="search-icon">ğŸ¬</span>
            <input id="tmdbSearch" type="text" placeholder="TMDB í›„ë³´ ê²€ìƒ‰(ìƒ˜í”Œ)" oninput="noop()" />
          </div>
          <button class="btn btn-secondary" onclick="runTmdbBatchSuggest()">ìë™ ì¶”ì²œ</button>
          <button class="btn btn-secondary" onclick="confirmTmdbMatch()">í™•ì • ë§¤ì¹­</button>
          <button class="btn btn-secondary" onclick="clearTmdbSelection()">ì„ íƒ í•´ì œ</button>
          ${commonRight}
        `;
        return;
      }

      if (view === 'organize') {
        toolbar.innerHTML = `
          <div class="search-box">
            <span class="search-icon">ğŸ“¦</span>
            <input type="text" placeholder="ì •ë¦¬ í ê²€ìƒ‰(ìƒ˜í”Œ)" oninput="noop()" />
          </div>
          <button class="btn btn-secondary" onclick="runPreflight()">í”„ë¦¬í”Œë¼ì´íŠ¸</button>
          <button class="btn btn-secondary" onclick="refreshOrganizeQueue()">ìƒˆë¡œê³ ì¹¨</button>
          <button class="btn btn-primary" onclick="executeAllOrganize()">â–¶ï¸ ì •ë¦¬ ì‘ì—… ì‹¤í–‰</button>
          ${commonRight}
        `;
        return;
      }

      if (view === 'rollback') {
        toolbar.innerHTML = `
          <div class="search-box">
            <span class="search-icon">â†©ï¸</span>
            <input type="text" placeholder="ë¡¤ë°± í•­ëª© ê²€ìƒ‰(ìƒ˜í”Œ)" oninput="noop()" />
          </div>
          <button class="btn btn-secondary" onclick="seedRollback()">ìƒ˜í”Œ ìƒì„±</button>
          <button class="btn btn-secondary" onclick="executeRollback()">ë¡¤ë°± ì‹¤í–‰</button>
          ${commonRight}
        `;
        return;
      }

      if (view === 'cache') {
        toolbar.innerHTML = `
          <div class="search-box">
            <span class="search-icon">ğŸ’¾</span>
            <input type="text" placeholder="ìºì‹œ í‚¤/ë¦¬ì†ŒìŠ¤ ê²€ìƒ‰(ìƒ˜í”Œ)" oninput="noop()" />
          </div>
          <button class="btn btn-secondary" onclick="pruneCache()">ì •ë¦¬</button>
          <button class="btn btn-secondary" onclick="verifyCache()">ê²€ì‚¬</button>
          <button class="btn btn-secondary" onclick="rebuildIndex()">ì¬ë¹Œë“œ</button>
          ${commonRight}
        `;
        return;
      }

      if (view === 'verify') {
        toolbar.innerHTML = `
          <div class="search-box">
            <span class="search-icon">âœ…</span>
            <input type="text" placeholder="ê²€ì¦ ê²°ê³¼ ê²€ìƒ‰(ìƒ˜í”Œ)" oninput="noop()" />
          </div>
          <button class="btn btn-secondary" onclick="runVerify()">TMDB ê²€ì¦</button>
          <button class="btn btn-secondary" onclick="verifySettings()">ì„¤ì • ê²€ì¦</button>
          <button class="btn btn-secondary" onclick="openSettings()">ì„¤ì • ì—´ê¸°</button>
          ${commonRight}
        `;
        return;
      }

      if (view === 'logs') {
        toolbar.innerHTML = `
          <div class="search-box">
            <span class="search-icon">ğŸ“</span>
            <input type="text" placeholder="ë¡œê·¸ ë¹ ë¥¸ ê²€ìƒ‰(ìƒ˜í”Œ)" oninput="document.getElementById('logQuery').value=this.value; renderLogs();" />
          </div>
          <button class="btn btn-secondary" onclick="appendLog()">ë¡œê·¸ ì¶”ê°€</button>
          <button class="btn btn-secondary" onclick="clearLogs()">ì§€ìš°ê¸°</button>
          ${commonRight}
        `;
        return;
      }

      toolbar.innerHTML = commonRight;
    }

    function labelForView(view) {
      const map = {
        groups: 'ê·¸ë£¹ ê´€ë¦¬',
        tmdb: 'TMDB ë§¤ì¹­',
        organize: 'íŒŒì¼ ì •ë¦¬',
        rollback: 'ë¡¤ë°± ê´€ë¦¬',
        verify: 'ê²€ì¦',
        cache: 'ìºì‹œ ê´€ë¦¬',
        logs: 'ë¡œê·¸ ë³´ê¸°'
      };
      return map[view] ?? view;
    }

    function noop() {}

    // ===== Groups =====
    function renderGroups(groups) {
      const grid = document.getElementById('groupsGrid');
      grid.innerHTML = groups.map(group => `
        <div class="group-card" onclick="openGroupDetail(${group.id})">
          <div class="group-card-header">
            <div class="group-title">${group.title}</div>
            <div class="group-meta">
              <span>ì‹œì¦Œ ${group.season}</span>
              <span>ì´ ${group.episodes}í™”</span>
            </div>
          </div>
          <div class="group-card-body">
            <div class="group-info">
              <span class="info-badge"><span class="file-count">${group.files}ê°œ</span> íŒŒì¼</span>
              <span class="info-badge">${group.resolution}</span>
              <span class="info-badge">${group.language.toUpperCase()}</span>
              ${group.matched
                ? '<span class="info-badge" style="background:#10b98115; color:#047857;">âœ“ ë§¤ì¹­ë¨</span>'
                : '<span class="info-badge" style="background:#f59e0b15; color:#b45309;">ë¯¸ë§¤ì¹­</span>'
              }
            </div>
            ${group.matched ? `
              <div class="group-progress">
                <div class="progress-label">
                  <span>ë§¤ì¹­ ì‹ ë¢°ë„</span>
                  <span>${group.confidence}%</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: ${group.confidence}%"></div>
                </div>
              </div>
            ` : `
              <div class="muted" style="font-size:0.85rem; margin-top:1rem;">TMDB ë§¤ì¹­ì„ ì‹¤í–‰í•˜ì„¸ìš”.</div>
            `}
          </div>
        </div>
      `).join('');
      updateStats();
    }

    function openGroupDetail(groupId) {
      const group = currentGroups.find(g => g.id === groupId);
      if (!group) return;

      selectedGroup = group;
      document.getElementById('detailTitle').textContent = group.title;
      document.getElementById('detailMeta').textContent = `ì‹œì¦Œ ${group.season} | ${group.episodes}í™” | ${group.resolution}`;
      
      document.getElementById('detailInfo').innerHTML = `
        <div class="info-badge" style="display:block; margin-bottom:0.5rem;">íŒŒì¼: ${group.files}ê°œ</div>
        <div class="info-badge" style="display:block; margin-bottom:0.5rem;">í•´ìƒë„: ${group.resolution}</div>
        <div class="info-badge" style="display:block; margin-bottom:0.5rem;">ì–¸ì–´: ${group.language.toUpperCase()}</div>
        ${group.matched ? `<div class="info-badge" style="display:block; background:#10b98115; color:#047857;">ë§¤ì¹­ë¨ (${group.confidence}%)</div>` : '<div class="info-badge" style="display:block; background:#f59e0b15; color:#b45309;">ë¯¸ë§¤ì¹­</div>'}
      `;

      // Sample file list
      document.getElementById('detailFiles').innerHTML = Array.from({length: group.files}, (_, i) => `
        <li class="file-item">
          <div class="file-name">Episode ${i + 1}.mkv</div>
          <div class="file-meta">${group.resolution} | ${group.language.toUpperCase()}</div>
        </li>
      `).join('');

      document.getElementById('detailPanel').classList.add('open');
    }

    function closeDetailPanel() {
      document.getElementById('detailPanel').classList.remove('open');
    }

    function searchGroups(query) {
      if (!query.trim()) {
        renderGroups(currentGroups);
        return;
      }
      const filtered = currentGroups.filter(g => 
        g.title.toLowerCase().includes(query.toLowerCase())
      );
      renderGroups(filtered);
    }

    function filterGroups(type) {
      let filtered = currentGroups;
      if (type === 'matched') filtered = currentGroups.filter(g => g.matched);
      if (type === 'unmatched') filtered = currentGroups.filter(g => !g.matched);
      renderGroups(filtered);
    }

    function updateStats() {
      document.getElementById('totalGroups').textContent = currentGroups.length;
      document.getElementById('totalFiles').textContent = currentGroups.reduce((sum, g) => sum + g.files, 0);
      document.getElementById('matchedGroups').textContent = currentGroups.filter(g => g.matched).length;
      document.getElementById('pendingOrganize').textContent = currentGroups.filter(g => g.matched).length;
    }

    // ===== TMDB =====
    function renderTmdbQueue() {
      const unmatched = currentGroups.filter(g => !g.matched);
      const tbody = document.getElementById('tmdbQueue');
      tbody.innerHTML = unmatched.map(g => `
        <tr style="cursor:pointer;" onclick="selectTmdbGroup(${g.id})">
          <td>${g.title}</td>
          <td><span class="tag warn">ë¯¸ë§¤ì¹­</span></td>
          <td>${tmdbSuggestions.has(g.id) ? `${tmdbSuggestions.get(g.id).length}ê°œ` : '-'}</td>
          <td>
            <button class="btn btn-ghost" onclick="event.stopPropagation(); suggestTmdb(${g.id})">ì¶”ì²œ</button>
          </td>
        </tr>
      `).join('');
    }

    function selectTmdbGroup(groupId) {
      tmdbSelectedId = groupId;
      const group = currentGroups.find(g => g.id === groupId);
      document.getElementById('tmdbSelected').textContent = `ì„ íƒ: ${group.title}`;
      
      const candidates = tmdbSuggestions.get(groupId) || [];
      document.getElementById('tmdbCandidates').innerHTML = candidates.length > 0
        ? candidates.map((c, i) => `
            <div style="padding:0.8rem; background:#f8fafc; border-radius:8px; margin-bottom:0.5rem; cursor:pointer; border:2px solid ${i === 0 ? '#667eea' : '#e2e8f0'};" onclick="confirmTmdbCandidate(${groupId}, ${i})">
              <div style="font-weight:700;">${c.title}</div>
              <div class="muted" style="font-size:0.85rem;">${c.year} | ì‹ ë¢°ë„: ${c.confidence}%</div>
            </div>
          `).join('')
        : '<div class="muted">ì¶”ì²œ í›„ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ìë™ ì¶”ì²œì„ ì‹¤í–‰í•˜ì„¸ìš”.</div>';
      
      renderTmdbQueue();
    }

    function suggestTmdb(groupId) {
      const candidates = [
        { title: "Sample Match 1", year: 2023, confidence: 92 },
        { title: "Sample Match 2", year: 2022, confidence: 85 }
      ];
      tmdbSuggestions.set(groupId, candidates);
      renderTmdbQueue();
      if (tmdbSelectedId === groupId) selectTmdbGroup(groupId);
    }

    function runTmdbBatchSuggest() {
      const unmatched = currentGroups.filter(g => !g.matched);
      unmatched.forEach(g => suggestTmdb(g.id));
      setStatus(`ìë™ ì¶”ì²œ ì™„ë£Œ: ${unmatched.length}ê°œ ê·¸ë£¹`, 'ok');
    }

    function confirmTmdbCandidate(groupId, index) {
      const group = currentGroups.find(g => g.id === groupId);
      if (!group) return;
      
      group.matched = true;
      group.confidence = tmdbSuggestions.get(groupId)[index].confidence;
      
      renderGroups(currentGroups);
      renderTmdbQueue();
      clearTmdbSelection();
      setStatus(`${group.title} ë§¤ì¹­ ì™„ë£Œ`, 'ok');
    }

    function confirmTmdbMatch() {
      if (!tmdbSelectedId) return;
      const candidates = tmdbSuggestions.get(tmdbSelectedId);
      if (!candidates || candidates.length === 0) return;
      confirmTmdbCandidate(tmdbSelectedId, 0);
    }

    function clearTmdbSelection() {
      tmdbSelectedId = null;
      document.getElementById('tmdbSelected').textContent = 'ì¢Œì¸¡ íì—ì„œ ê·¸ë£¹ì„ ì„ íƒí•˜ì„¸ìš”.';
      document.getElementById('tmdbCandidates').innerHTML = '<div class="muted">ì„ íƒëœ ê·¸ë£¹ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
      renderTmdbQueue();
    }

    // ===== Organize =====
    function refreshOrganizeQueue() {
      const matched = currentGroups.filter(g => g.matched);
      const tbody = document.getElementById('organizeQueue');
      tbody.innerHTML = matched.map(g => `
        <tr>
          <td>${g.title}</td>
          <td>${g.files}ê°œ</td>
          <td style="font-size:0.85rem; color:#64748b;">/Anime/${g.title}/Season ${g.season}/</td>
          <td>
            <button class="btn btn-primary" onclick="organizeGroup(${g.id})">ì •ë¦¬</button>
          </td>
        </tr>
      `).join('');
    }

    function applyRulePreset() {
      setStatus('í”„ë¦¬ì…‹ ì ìš© ì™„ë£Œ', 'ok');
    }

    function runPreflight() {
      const results = document.getElementById('preflightResults');
      results.innerHTML = `
        <div class="tag ok">âœ“ ì¶©ëŒ ì—†ìŒ</div>
        <div class="tag ok">âœ“ ê¶Œí•œ í™•ì¸ë¨</div>
        <div class="tag ok">âœ“ ì¤‘ë³µ ì—†ìŒ</div>
        <div class="muted" style="font-size:0.9rem; margin-top:0.5rem;">ëª¨ë“  ì²´í¬ë¥¼ í†µê³¼í–ˆìŠµë‹ˆë‹¤. ì •ë¦¬ ì‘ì—…ì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
      `;
      setStatus('í”„ë¦¬í”Œë¼ì´íŠ¸ ì²´í¬ ì™„ë£Œ', 'ok');
    }

    function appendOrganizeLog() {
      const log = document.getElementById('organizeLog');
      const time = new Date().toLocaleTimeString();
      log.textContent += `[${time}] ìƒ˜í”Œ ë¡œê·¸ í•­ëª© ì¶”ê°€\n`;
    }

    function organizeGroup(groupId) {
      const group = currentGroups.find(g => g.id === groupId);
      if (!group) return;
      
      setStatus(`ê·¸ë£¹ ì •ë¦¬ ì‹œì‘: ${group.title}`, 'ok');
      showLoading(`${group.title} ì •ë¦¬ ì¤‘...`);
      
      setTimeout(() => {
        hideLoading();
        const time = new Date().toLocaleTimeString();
        const log = document.getElementById('organizeLog');
        log.textContent += `[${time}] ì •ë¦¬ ì™„ë£Œ: ${group.title} (${group.files}ê°œ íŒŒì¼)\n`;
        log.scrollTop = log.scrollHeight;
        
        setStatus(`ê·¸ë£¹ ì •ë¦¬ ì™„ë£Œ: ${group.title}`, 'ok');
        refreshOrganizeQueue();
      }, 2000);
    }

    function executeAllOrganize() {
      const matchedGroups = currentGroups.filter(g => g.matched);
      if (matchedGroups.length === 0) {
        setStatus('ì •ë¦¬í•  ê·¸ë£¹ì´ ì—†ìŠµë‹ˆë‹¤. ë§¤ì¹­ì´ ì™„ë£Œëœ ê·¸ë£¹ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'warn');
        return;
      }

      if (!confirm(`${matchedGroups.length}ê°œ ê·¸ë£¹ì„ ì •ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        return;
      }

      setStatus(`ì „ì²´ ì •ë¦¬ ì‘ì—… ì‹œì‘: ${matchedGroups.length}ê°œ ê·¸ë£¹`, 'ok');
      showLoading(`ì •ë¦¬ ì‘ì—… ì§„í–‰ ì¤‘... (0/${matchedGroups.length})`);

      let completed = 0;
      const total = matchedGroups.length;

      matchedGroups.forEach((group, index) => {
        setTimeout(() => {
          completed++;
          document.getElementById('loadingMessage').textContent = 
            `ì •ë¦¬ ì‘ì—… ì§„í–‰ ì¤‘... (${completed}/${total}) - ${group.title}`;
          
          const time = new Date().toLocaleTimeString();
          const log = document.getElementById('organizeLog');
          log.textContent += `[${time}] ì •ë¦¬ ì™„ë£Œ: ${group.title} (${group.files}ê°œ íŒŒì¼)\n`;
          log.scrollTop = log.scrollHeight;

          if (completed === total) {
            setTimeout(() => {
              hideLoading();
              setStatus(`ì „ì²´ ì •ë¦¬ ì‘ì—… ì™„ë£Œ: ${total}ê°œ ê·¸ë£¹`, 'ok');
              refreshOrganizeQueue();
            }, 500);
          }
        }, (index + 1) * 1000);
      });
    }

    // ===== Rollback =====
    function seedRollback() {
      rollbackItems = [
        { id: 1, time: '2024-01-15 14:30:00', group: 'ì§„ê²©ì˜ ê±°ì¸ Season 4', changes: '16ê°œ íŒŒì¼ ì´ë™', status: 'ì™„ë£Œ' },
        { id: 2, time: '2024-01-14 10:20:00', group: 'ê·€ë©¸ì˜ ì¹¼ë‚ ', changes: '7ê°œ íŒŒì¼ ì´ë™', status: 'ì™„ë£Œ' }
      ];
      renderRollback();
    }

    function renderRollback() {
      const tbody = document.getElementById('rollbackTable');
      tbody.innerHTML = rollbackItems.map(item => `
        <tr style="cursor:pointer;" onclick="selectRollback(${item.id})">
          <td>${item.time}</td>
          <td>${item.group}</td>
          <td>${item.changes}</td>
          <td><span class="tag ok">${item.status}</span></td>
          <td>
            <button class="btn btn-ghost" onclick="event.stopPropagation(); executeRollback(${item.id})">ë¡¤ë°±</button>
          </td>
        </tr>
      `).join('');
    }

    function selectRollback(id) {
      rollbackSelectedId = id;
      const item = rollbackItems.find(r => r.id === id);
      document.getElementById('rollbackDetail').innerHTML = `
        <div class="panel-title" style="margin-bottom:1rem;">${item.group}</div>
        <div class="muted" style="margin-bottom:0.5rem;">ì‹œê°„: ${item.time}</div>
        <div class="muted" style="margin-bottom:0.5rem;">ë³€ê²½ì‚¬í•­: ${item.changes}</div>
        <div class="muted" style="margin-bottom:1rem;">ìƒíƒœ: ${item.status}</div>
        <div class="file-list">
          ${Array.from({length: 5}, (_, i) => `
            <li class="file-item">
              <div class="file-name">íŒŒì¼ ${i + 1}.mkv</div>
              <div class="file-meta">ì›ë³¸ ê²½ë¡œì—ì„œ ì´ë™ë¨</div>
            </li>
          `).join('')}
        </div>
      `;
    }

    function executeRollback(id) {
      if (!id && !rollbackSelectedId) return;
      const targetId = id || rollbackSelectedId;
      setStatus(`ë¡¤ë°± ì‹¤í–‰: ${rollbackItems.find(r => r.id === targetId)?.group}`, 'ok');
    }

    // ===== Cache =====
    function pruneCache() {
      setStatus('ì˜¤ë˜ëœ ìºì‹œ ì •ë¦¬ ì™„ë£Œ', 'ok');
    }

    function verifyCache() {
      setStatus('ìºì‹œ ë¬´ê²°ì„± ê²€ì‚¬ ì™„ë£Œ', 'ok');
    }

    function rebuildIndex() {
      setStatus('ì¸ë±ìŠ¤ ì¬ë¹Œë“œ ì‹œì‘...', 'ok');
      setTimeout(() => setStatus('ì¸ë±ìŠ¤ ì¬ë¹Œë“œ ì™„ë£Œ', 'ok'), 2000);
    }

    function appendCacheEvent() {
      const events = document.getElementById('cacheEvents');
      const time = new Date().toLocaleTimeString();
      events.textContent += `[${time}] ìƒ˜í”Œ ìºì‹œ ì´ë²¤íŠ¸ ì¶”ê°€\n`;
    }

    // ===== Logs =====
    function seedLogs() {
      logs = [
        { time: '14:30:15', level: 'INFO', module: 'scanner', message: 'ë””ë ‰í„°ë¦¬ ìŠ¤ìº” ì‹œì‘' },
        { time: '14:30:20', level: 'INFO', module: 'scanner', message: '15ê°œ íŒŒì¼ ë°œê²¬' },
        { time: '14:30:25', level: 'WARN', module: 'tmdb', message: 'TMDB API ì‘ë‹µ ì§€ì—°' },
        { time: '14:30:30', level: 'INFO', module: 'organizer', message: 'íŒŒì¼ ì •ë¦¬ ì™„ë£Œ' }
      ];
      renderLogs();
    }

    function renderLogs() {
      const level = document.getElementById('logLevel').value;
      const module = document.getElementById('logModule').value;
      const query = document.getElementById('logQuery').value.toLowerCase();

      let filtered = logs;
      if (level !== 'ALL') filtered = filtered.filter(l => l.level === level);
      if (module !== 'ALL') filtered = filtered.filter(l => l.module === module);
      if (query) filtered = filtered.filter(l => l.message.toLowerCase().includes(query));

      const viewer = document.getElementById('logViewer');
      viewer.innerHTML = filtered.map(log => `
        <div style="margin-bottom:0.5rem;">
          <span style="color:#94a3b8;">[${log.time}]</span>
          <span style="color:${log.level === 'ERROR' ? '#ef4444' : log.level === 'WARN' ? '#f59e0b' : '#10b981'};">[${log.level}]</span>
          <span style="color:#667eea;">[${log.module}]</span>
          <span>${log.message}</span>
        </div>
      `).join('');
      viewer.scrollTop = viewer.scrollHeight;
    }

    function appendLog() {
      const levels = ['INFO', 'WARN', 'ERROR'];
      const modules = ['scanner', 'tmdb', 'organizer', 'cache'];
      const time = new Date().toLocaleTimeString();
      logs.push({
        time,
        level: levels[Math.floor(Math.random() * levels.length)],
        module: modules[Math.floor(Math.random() * modules.length)],
        message: `ìƒ˜í”Œ ë¡œê·¸ ë©”ì‹œì§€ ${logs.length + 1}`
      });
      renderLogs();
    }

    function clearLogs() {
      logs = [];
      renderLogs();
    }

    function exportLogs() {
      setStatus('ë¡œê·¸ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ (ìƒ˜í”Œ)', 'ok');
    }

    // ===== Verify =====
    function runVerify() {
      showLoading('TMDB ì—°ê²° ê²€ì¦ ì¤‘...');
      
      // Reset status
      document.getElementById('verifyApiKey').className = 'tag';
      document.getElementById('verifyApiKey').textContent = 'â³ API í‚¤';
      document.getElementById('verifyConnectivity').className = 'tag';
      document.getElementById('verifyConnectivity').textContent = 'â³ ì—°ê²°';
      document.getElementById('verifyAuth').className = 'tag';
      document.getElementById('verifyAuth').textContent = 'â³ ì¸ì¦';

      // Simulate verification
      setTimeout(() => {
        const apiKey = document.getElementById('settingApiKey')?.value || '';
        const hasApiKey = apiKey.length >= 10;
        
        // API Key check
        if (hasApiKey) {
          document.getElementById('verifyApiKey').className = 'tag ok';
          document.getElementById('verifyApiKey').textContent = 'âœ“ API í‚¤';
        } else {
          document.getElementById('verifyApiKey').className = 'tag warn';
          document.getElementById('verifyApiKey').textContent = 'âš ï¸ API í‚¤';
        }

        // Connectivity check
        document.getElementById('verifyConnectivity').className = 'tag ok';
        document.getElementById('verifyConnectivity').textContent = 'âœ“ ì—°ê²°';

        // Auth check
        if (hasApiKey) {
          document.getElementById('verifyAuth').className = 'tag ok';
          document.getElementById('verifyAuth').textContent = 'âœ“ ì¸ì¦';
        } else {
          document.getElementById('verifyAuth').className = 'tag warn';
          document.getElementById('verifyAuth').textContent = 'âš ï¸ ì¸ì¦';
        }

        const results = document.getElementById('verifyResults');
        if (hasApiKey) {
          results.innerHTML = `
            <div class="tag ok">âœ“ ê²€ì¦ ì„±ê³µ</div>
            <div style="font-size:0.9rem; color:#047857;">
              TMDB ì—°ê²°ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤. API í‚¤ê°€ ìœ íš¨í•©ë‹ˆë‹¤.
            </div>
          `;
          setStatus('TMDB ì—°ê²° ê²€ì¦ ì™„ë£Œ: ì„±ê³µ', 'ok');
        } else {
          results.innerHTML = `
            <div class="tag warn">âš ï¸ ê²€ì¦ ë¶€ë¶„ ì‹¤íŒ¨</div>
            <div style="font-size:0.9rem; color:#b45309;">
              API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì„¤ì •ì—ì„œ API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
            </div>
          `;
          setStatus('TMDB ì—°ê²° ê²€ì¦ ì™„ë£Œ: API í‚¤ í•„ìš”', 'warn');
        }

        hideLoading();
      }, 1500);
    }

    function verifySettings() {
      const sourceFolder = document.getElementById('settingSourceFolder')?.value || '';
      const targetFolder = document.getElementById('settingTargetFolder')?.value || '';
      const apiKey = document.getElementById('settingApiKey')?.value || '';

      const results = document.getElementById('settingsVerifyResults');
      
      // Check config file
      document.getElementById('configFileStatus').textContent = 'âœ“ ì •ìƒ';
      document.getElementById('configFileStatus').style.color = '#047857';

      // Check API key
      if (apiKey.length >= 10) {
        document.getElementById('apiKeyConfigStatus').textContent = 'âœ“ ì„¤ì •ë¨';
        document.getElementById('apiKeyConfigStatus').style.color = '#047857';
      } else {
        document.getElementById('apiKeyConfigStatus').textContent = 'âš ï¸ ë¯¸ì„¤ì •';
        document.getElementById('apiKeyConfigStatus').style.color = '#b45309';
      }

      // Check folder paths
      if (sourceFolder && targetFolder) {
        document.getElementById('folderPathStatus').textContent = 'âœ“ ì„¤ì •ë¨';
        document.getElementById('folderPathStatus').style.color = '#047857';
      } else {
        document.getElementById('folderPathStatus').textContent = 'âš ï¸ ë¯¸ì„¤ì •';
        document.getElementById('folderPathStatus').style.color = '#b45309';
      }

      // Check auto scan
      const autoScan = document.getElementById('settingAutoScanStartup')?.checked || false;
      const interval = parseInt(document.getElementById('settingAutoScanInterval')?.value || '0');
      if (autoScan || interval > 0) {
        document.getElementById('autoScanStatus').textContent = 'âœ“ í™œì„±í™”';
        document.getElementById('autoScanStatus').style.color = '#047857';
      } else {
        document.getElementById('autoScanStatus').textContent = 'âš ï¸ ë¹„í™œì„±í™”';
        document.getElementById('autoScanStatus').style.color = '#64748b';
      }

      results.innerHTML = `
        <div class="tag ok">âœ“ ê²€ì¦ ì™„ë£Œ</div>
        <div class="muted" style="font-size:0.9rem;">
          ì„¤ì • íŒŒì¼ê³¼ êµ¬ì„± ì˜µì…˜ì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.
        </div>
      `;

      setStatus('ì„¤ì • ê²€ì¦ ì™„ë£Œ', 'ok');
    }

    // ===== Settings =====
    function openSettings() {
      document.getElementById('settingsModal').classList.add('active');
      switchSettingsTab('api');
    }

    function closeSettings() {
      document.getElementById('settingsModal').classList.remove('active');
    }

    function switchSettingsTab(tab) {
      // Hide all tabs
      document.getElementById('settingsTabApi').classList.remove('active');
      document.getElementById('settingsTabApi').style.display = 'none';
      document.getElementById('settingsTabFolders').classList.remove('active');
      document.getElementById('settingsTabFolders').style.display = 'none';

      // Remove active from all buttons
      document.getElementById('tabApiKey').classList.remove('active');
      document.getElementById('tabApiKey').style.borderBottomColor = 'transparent';
      document.getElementById('tabApiKey').style.color = '#64748b';
      document.getElementById('tabApiKey').style.fontWeight = '500';
      document.getElementById('tabFolders').classList.remove('active');
      document.getElementById('tabFolders').style.borderBottomColor = 'transparent';
      document.getElementById('tabFolders').style.color = '#64748b';
      document.getElementById('tabFolders').style.fontWeight = '500';

      // Show selected tab
      if (tab === 'api') {
        document.getElementById('settingsTabApi').classList.add('active');
        document.getElementById('settingsTabApi').style.display = 'block';
        document.getElementById('tabApiKey').classList.add('active');
        document.getElementById('tabApiKey').style.borderBottomColor = '#667eea';
        document.getElementById('tabApiKey').style.color = '#667eea';
        document.getElementById('tabApiKey').style.fontWeight = '600';
      } else if (tab === 'folders') {
        document.getElementById('settingsTabFolders').classList.add('active');
        document.getElementById('settingsTabFolders').style.display = 'block';
        document.getElementById('tabFolders').classList.add('active');
        document.getElementById('tabFolders').style.borderBottomColor = '#667eea';
        document.getElementById('tabFolders').style.color = '#667eea';
        document.getElementById('tabFolders').style.fontWeight = '600';
      }
    }

    function browseFolder(type) {
      // In a real implementation, this would open a folder picker
      // For sample, just set a placeholder path
      if (type === 'source') {
        document.getElementById('settingSourceFolder').value = '/Users/example/Anime/Source';
      } else if (type === 'target') {
        document.getElementById('settingTargetFolder').value = '/Users/example/Anime/Target';
      }
      setStatus(`í´ë” ì„ íƒ: ${type}`, 'ok');
    }

    function saveSettings() {
      const apiKey = document.getElementById('settingApiKey')?.value || '';
      
      if (apiKey && apiKey.length < 10) {
        setStatus('API í‚¤ê°€ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤ (ìµœì†Œ 10ì)', 'warn');
        return;
      }

      // Save settings (simulated)
      setStatus('ì„¤ì • ì €ì¥ ì™„ë£Œ', 'ok');
      closeSettings();
      
      // If verify view is active, refresh it
      if (currentView === 'verify') {
        verifySettings();
      }
    }

    function resetSettings() {
      // Reset API Key tab
      document.getElementById('settingApiKey').value = '';
      
      // Reset Folders tab
      document.getElementById('settingSourceFolder').value = '';
      document.getElementById('settingTargetFolder').value = '';
      document.getElementById('settingOrganizeByResolution').checked = false;
      document.getElementById('settingOrganizeByYear').checked = false;
      document.getElementById('settingAutoScanStartup').checked = false;
      document.getElementById('settingAutoScanInterval').value = 0;
      document.getElementById('settingIncludeSubdirs').checked = true;
      
      setStatus('ì„¤ì • ì´ˆê¸°í™” ì™„ë£Œ', 'ok');
    }

    // ===== Utilities =====
    function scanDirectory() {
      showLoading('ë””ë ‰í„°ë¦¬ ìŠ¤ìº” ì¤‘...');
      setTimeout(() => {
        hideLoading();
        setStatus('ìŠ¤ìº” ì™„ë£Œ', 'ok');
        renderGroups(currentGroups);
      }, 1500);
    }

    function matchGroup() {
      if (!selectedGroup) return;
      switchView('tmdb');
      setTimeout(() => selectTmdbGroup(selectedGroup.id), 100);
    }

    function showLoading(message) {
      document.getElementById('loadingMessage').textContent = message;
      document.getElementById('loadingOverlay').classList.add('active');
    }

    function hideLoading() {
      document.getElementById('loadingOverlay').classList.remove('active');
    }

    function setStatus(text, type = 'ok') {
      document.getElementById('statusText').textContent = text;
      const dot = document.getElementById('statusDot');
      dot.style.background = type === 'ok' ? '#10b981' : type === 'warn' ? '#f59e0b' : '#ef4444';
    }

    // ===== Initialize =====
    init();
  </script>
</body>
</html>